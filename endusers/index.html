<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
@authors: Tamas Kohegyi
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>Wilma End-Users's Guide</title>

    <link rel="stylesheet" href="../static/elstyle.css" type="text/css"/>
    <link rel="stylesheet" href="../static/pygments.css" type="text/css"/>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <link id="favicon" rel="shortcut icon" type="image/png" href="../static/icon-wilma.png" />
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
</head>
<body>

<div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">
            <div class="body">

                <div class="section" id="wilma-open-source">
                    <h1>End-user information</h1>
                </div>

                <h2>Getting the latest release</h2>
                <p>You may find the project itself on GitHub, from where you may download the latest release from the following URL:</p>
                <p style="margin-left: 30.0px;">
                    <a href="https://github.com/epam/Wilma/releases">https://github.com/epam/Wilma/releases</a>
                </p>

                <p>Usually 2 zip files are there: </p>
                <ul style="list-style-type: square;">
                    <li><b><code>wilma-application-&lt;version&gt;.zip</code></b> that contains everything that's needed to run the
                        Wilma Application.</li>
                    <li><b><code>wilma-message-search-application-&lt;version&gt;.zip</code></b> that contains everything that's needed to run the
                        Wilma Message Search Application.</li>
                </ul>

                <p>Example of <b><code>wilma-application-&lt;version&gt;.zip</code></b> (about 33 Mbytes):</p>
                <ul style="list-style-type: square;">
                    <li>certificate - folder  with wilma.cer and wilma.jks files, in order to handle https requests</li>
                    <li>config - folder with formatter and checker java example classes, and the template folder</li>
                    <li>COPYRIGHTS - folder that contains all Licences used in any of the 3rd party libs/jars</li>
                    <li>wilma-&lt;version&gt;.jar - the executable Wilma Application </li>
                    <li>stubConfig.xml - a sample stub-config configuration</li>
                    <li>readme.txt - yep, a read-me file</li>
                    <li>wilma.conf.properties - property file with default settings</li>
                </ul>

                <h2>Requirements</h2>
                <p>Java Runtime Environment 7 is required for running Wilma. (<a
                        href="http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html">http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html</a>)
                </p>

                <h2>Configuring the tool</h2>

                <p>After downloading the zip file, unpack its contents to a selected folder.</p>

                <p>To run Wilma it should be configured first in <code>wilma.conf.properties.</code>
                </p>

                <p>This configuration file must contain the following property entries (the values here are the default
                    ones):</p>
<pre>
########################################################################
# Copyright 2013-2015 EPAM Systems
#
# This file is part of Wilma.
#
# Wilma is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Wilma is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Wilma.  If not, see http://www.gnu.org/licenses/.
########################################################################

# the port used by the proxy
proxy.port=9092

# internal jetty port on which web application is deployed
internal.wilma.port=1234

#the size of the request buffer used by the web application in bytes
internal.wilma.request.buffer.size=81920
#the size of the response buffer used by the web application in bytes
internal.wilma.response.buffer.size=204800

# port used to communicate with the indexing application
# via an activemq broker
jms.queue.port=16161

# the value of the request time out in milliseconds
proxy.request.timeout=20000

# the number of requests that can go through the proxy per second
# without a warning
request.warning.limit=9000

# the number of requests that can go through the proxy per second without an error.
# Requests above this limit are aborted.
request.error.limit=9999

# maintainer is executed periodically. Time period can be given with cron expression.
log.maintainer.cron=0 0/30 * * * *

# maintainer method can be one of the following: timelimit | filelimit
log.maintainer.method=timelimit

# limit on number of files to keep
log.maintainer.file.limit=10

# files older than this value are deleted if timelimit method is switched on
# (can be xD days or xH hours - e.g.: 12H, 2D)
log.maintainer.time.limit=1H

# target folder of the request, response log files
log.folder=messages

# guard period of the overload safeguard in seconds.
# 0 means that the safeguard is inactive,
# otherwise the time period can be given with cron expressions (e.g.: 0/3 * * * * *).
safeguard.guardperiod=0/3 * * * * *

# when the ActiveMQ queue size exceeds this limit,
# the FastInfoset decompression is turned off
safeguard.responseFIdecoder.OFFlimit=1200

# when the ActiveMQ queue size drops below this limit,
# the FastInfoset decompression is turned on
safeguard.responseFIdecoder.ONlimit=800

# when the ActiveMQ queue size exceeds this limit,
# response logging is turned off completely
safeguard.responseMessageWriter.OFFlimit=1500

# when the ActiveMQ queue size drops below this limit,
# response logging is turned on again
safeguard.responseMessageWriter.ONlimit=1000

# turns message logging on/off when Wilma starts
message.logging=on

# Relative folder path of the stub descriptor XML configuration files from project root.
stub.descriptors.path=

# Extension pattern of the stub descriptor XML configuration files
# (it could be a specific file or *.xml)
stub.descriptors.pattern=stubConfig.xml

# Relative folder path of the cached stub descriptor XML configuration files from project root.
stub.descriptors.cache.path=config/cache/stub_descriptors

# Max depth of the stub configuration dialog descriptor elements
# (condition-set-invoker, template-formatter-set-invoker) child's subtree.
# This is necessary because of recursive self referring.
stub.descriptor.max.depth=20

# Relative path of the stub template files folder from project root.
stub.template.path=config/templates

# Relative path of the stub condition checker classes folder from project root.
stub.condition.checker.path=config/condition-checkers

# Relative path of the stub template formatter classes folder from project root.
stub.template.formatter.path=config/formatters

# Relative path of the stub interceptor classes folder from project root.
stub.interceptor.path=config/interceptors

# Relative path of the jar and its classes folder from project root.
stub.jar.path=config/jar

# Relative path of the sequence handler classes folder from project root.
stub.sequence.handler.path=config/sequencehandlers

# switch between the following operation modes:
# proxy mode, stub mode and normal mode (valid inputs are: stub, proxy, wilma)
switch=wilma

# Interceptors - switch between using or not using Interceptors at all
# (config still will be loaded)
interceptor=off

# Block localhost usage - switch between forwarding messages
# addressed to localhost (mode: off) or denying them (mode: on)
block.localhost.usage=off

# Sequence Handling - Switch between enabling/disabling the sequence handling functionality
sequence.handling.state=on

# Defines the interval of waiting for the sequence responses (in milliseconds)
sequence.response.wait.interval=250

# the default timeout of sequences given in milliseconds
sequence.timeout=9000

# the url of readme and the text of the readme url
wilma.readme.url=http://epam.github.io/Wilma/
wilma.readme.text=Wilma Documentation

#Relative path to admin hosts file from project root.
#The admin hosts file should contain one hostname or IP per line.
wilma.admin.hosts.file=

# sequence cleaning is executed periodically. Time period can be given with cron expression.
sequence.cleanup.cron=0 0/03 * * * *
</pre>
                <p>There are two reserved ports which aren't configurable, 1099 and 2015. Pay attention to not use
                    them.</p>

                <p>The communication among the modules and between Wilma and Wilma Message Search goes through ActiveMQQueues.
                    The default port is 1099 to connect to that service which monitors the LoggerQueue and ResponseQueue
                    in Wilma. Port 2015 is used by this service in the Wilma Message Search.</p>

                <p>The hardcoded values are in these files:</p>
                <ul>
                    <li>com.epam.wilma.safeguard.monitor.JmsQueueMonitorTask</li>
                    <li>com.epam.message.search.web.controller.LoadInformationController</li>
                    <li>/wilma-message-search-lucene/src/main/resources/conf/spring/lucene-application-context.xml</li>
                </ul>


                <h2>Running the tool</h2>

                <p>After the configuration is done, you can run Wilma by entering the following command:</p>
                <code><pre>
java [-Dlogger=DEV]
     [-Xmx4096m]
     [-Djavax.net.ssl.keyStore=jks_holding_client_certificate]
     [-Djavax.net.ssl.keyStorePassword=password_of_jks]
     -jar wilma-&lt;version&gt;.jar wilma.conf.properties
                </pre></code>
                <ul>
                    <li>The VM argument <code>-Dlogger=DEV</code> is optional and can be used to log detailed more
                        information on the console.
                    </li>
                    <li>The VM argument <code>-Xmx</code> specifies the max heap space that Wilma can use. It is
                        recommended to set it at least to 4096m or even bigger if the load that goes through Wilma is
                        heavy.
                    </li>
                    <li>The VM argument <code>-Djavax.net.ssl.keyStore</code> specifies the Java Key Store file that
                        holds the client certificates that are needed for two-way SSL. 
                    </li>
                    <li>The VM argument <code>-Djavax.net.ssl.keyStorePassword </code>is the password of the Java Key
                        Store in the previous argument.
                    </li>
                </ul>
                <p>Wilma application logs are normally stored in the <strong>/log/app</strong> folder.</p>

                <p>The command above requires that the properties file is in the same folder as the JAR. If you place
                    the configuration file to a different location, you should run the JAR by specifying the full path
                    of the configuration file.
                <p>If the tool starts successfully, you should see something similar on the console:</p>
                <code><pre>
15:24:24 - Timelimit method is used to maintain log files with parameters: timelimit: 1H
15:24:24 - Wilma-v1.0.1
Copyright 2013-2015 EPAM Systems - GNU GPL-V3.0 License
Used port: 9092
Application logs are stored in 'D:\work\tmp\wilapp\log\app' folder.
Request-response pairs are stored in 'D:\work\tmp\wilapp\messages' folder.
                    </pre></code>
                <h2>Loading Stub Configs</h2>

                <p>At start up Wilma checks the cache folder (see parameter:
                    <strong>stub.descriptors.cache.path</strong>) how many file looks like *_stubConfig.xml where *
                    means &gt;0 integer value. If there is at least one file with this name pattern, Wilma will load
                    these files in order. If there is not any such file, then Wilma try to load the stub configuration
                    in the following steps.</p>
                <ol>
                    <li>Checks whether <strong>stub.descriptors.pattern</strong> contains a specific file name without
                        any *. If it contains, then Wilma looks for this file in that folder which is given <strong>stub.descriptors.path</strong> property. <br/>If
                        the given file does not exist in that folder, Wilma will shut down with an error message.
                    </li>
                    <li>If <strong>stub.descriptors.pattern</strong> contains a *, Wilma looks for those files in
                        the <strong>stub.descriptors.path</strong> folder which matched with the given pattern. <br/>This
                        pattern must be like *something.xml, *.xml ...!<br/>Note: "some*thing.xml" is a WRONG pattern,
                        Wilma is not able to work with such pattern!
                    </li>
                </ol>
                <h2>Using the tool</h2>
                <p>After Wilma starts, you can use it as an HTTP and HTTPS proxy that logs every request and response
                    that goes through it.</p>

                <h2>Configuring a Java client application to use Wilma as a proxy</h2>

                <p>If you want to use Wilma as a proxy in a Java client application, you must configure it to go through
                    Wilma.</p>

                <p>The most simple way to do this is by adding a few<strong> VM arguments </strong>to the run
                    configuration:</p>
                <code><pre>
-DproxyHost=[wilma-url]
-DproxyPort=[wilma-port]
-Djavax.net.ssl.trustStore=[path/to/wilma.jks]
-Djavax.net.ssl.trustStorePassword=vvilma
                    </pre></code>
                <ul>
                    <li>
                        <code>[wilma-url]</code> is the URL of the server where Wilma is running.
                    </li>
                    <li>
                        <code>[wilma-port]</code> is the port that is configured in wilma.conf.properties (<code>proxy.port</code>,
                        default is <strong>9092</strong>)
                    </li>
                    <li>
                        <code>[path/to/wilma.jks] </code>the path to the<code> wilma.jks </code>file (it can be found
                        in <code>wilma.zip</code> under <strong>certificate/wilma.jks</strong>)
                    </li>
                </ul>
                <p>The first 2 arguments mean that the application should use a proxy on the given host and port, the
                    third argument specifies a Java Key Store (JKS) file that contains the certificates trusted by the
                    client application.</p>

                <p>Wilma uses an unsigned certificate contained by <code>wilma.jks </code>to be able to proxy HTTPS
                    connections too<code>.</code>
                </p>

                <p>The client Java application has to be configured to accept this certificate to be able to access a
                    host that uses SSL.</p>

                <h2>Further information</h2>

                <ul>
                    <li><a class="reference external" href="feature_list.html">Feature list</a>
                        : All that Wilma can do for you
                    </li>
                    <li><a class="reference external" href="https://github.com/epam/Wilma/wiki/Wilma-Experience-@-Real-Projects">Project
                        experiences</a> : Solutions from the real-life
                    </li>
                    <!-- <li><a class="reference external" href="endusers/release_notes.html">Release
                        Notes</a> : About what was changed and when
                    </li>
                    -->
                </ul>

            </div>
        </div>
    </div>
    <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
            <a href="#">
                <img class="logo" src="../static/EPAM_LOGO_gray_blue.png" alt="Logo"/>
            </a>
        </p>

            <p/>

            <h3>Table Of Contents</h3>
            <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Wilma Home page</a></li>
                <li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to
                    Wilma</a></li>
                <li class="toctree-l1"><a class="reference internal" href="index.html">End-user information</a></li>
                <li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer
                    information</a></li>
                <li class="toctree-l1"><a class="reference internal" href="https://github.com/epam/Wilma/releases">Downloads</a></li>
                <li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact Info</a></li>
            </ul>
        </div>
    </div>
    <div class="clearer"></div>
</div>
<div class="footer">
    &copy;2015, EPAM Systems.
</div>


</body>
</html>